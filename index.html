<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:300,400,500">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/jquery.dataTables.min.css">
        <link rel="stylesheet" href="css/jquery-confirm.min.css">

        <script src="js/jquery-3.5.1.js"></script>
        <script src="js/jquery.dataTables.min.js"></script>
        <script src="js/jquery-confirm.min.js"></script>
        <script src="js/dom-checkbox.js"></script>
        <script src="js/jquery-sortSections.js"></script>
        <script src="js/muuri.min.js"></script>
        <script src="js/web-animations.min.js"></script>
        <script src="js/Chart.min.js"></script>
        <script src="js/fontawesome.min.js"></script>
        <script src="js/makeResizableDiv.js"></script>
        
        <script src="js/PieChart.js"></script>
        <script src="js/Point.js"></script>

        <title>Grid Dashboard</title>
        
    </head>
    <body>
        <div id="header">
            <input id="header_input" placeholder="New Dashboard">
            <div id="action_bar">
                <div id="widget_bar" class="bounding_box">
                    <div class="dropdown_button">
                        <button title="Add new widget" class="action_button" id="add_widget"><i class="fa fa-square-plus"></i></button>
                        <div class="dropdown_content">
                            <li><i class="fa fa-chart-simple"></i>&emsp;Column</li>
                            <li id="add_pie_chart_button"><i class="fa fa-chart-pie"></i>&emsp;Pie</li>
                            <li><i class="fa fa-arrow-up-right-dots"></i>&emsp;Scatter</li>
                        </div>
                    </div>
                    <button title="Enable Select-Edit" class="action_button" id="enable_select-edit"><i class="fa fa-pen-to-square"></i></button>
                </div>
                <div id="dashboard_bar" class="bounding_box">
                    <button title="Create New Dashboard" class="action_button" id="new_dashboard"><i class="fa fa-arrow-up-right-from-square"></i></button>
                    <button title="Save Dashboard" class="action_button" id="save_dashboard"><i class="fa fa-floppy-disk"></i></button>
                    <button title="Delete Dashboard" class="action_button" id="delete_dashboard"><i class="fa fa-trash"></i></button>
                    <button title="Dashboard Menu" class="action_button" id="dashboard_menu"><i class="fa fa-bars"></i></button>
                </div>
            </div>
        </div>
        
    <div id="grid" class="grid">
         
        
    </div>
    
        
        
       
<div id="edit_widget_container" class="panel_container hidden">
    <div class="blur_backdrop"></div>
    <span id="edit_widget_panel">
        <div class="top_bar">
            <button class="action_button close_button"><i class="fa fa-xmark"></i></button>
        </div>
        <div class="panel_header">Edit Widget</div>
        <div class="panel_section">
            <table id="edit_widget_table"></table>
            <button id="edit_widget_submit">Submit</button>
        </div>
    </span>
</div> 
        
        
<script>
    // create new grid layout
    var grid = new Muuri('.grid', {
        dragEnabled: true,
          dragStartPredicate: function (item, e) {
            grid.refreshItems();
            grid.layout();
            if (e.type != "move" && e.target.classList.contains("chartjs-render-monitor")) {
              return true;
            }
            // save sort order
              saveOrder();
          },
    });
        
    const ctx = $('#myChart');
    const myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
                label: '# of Votes',
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            maintainAspectRatio: false
            
        }
    });
    const ctx2 = $('#myChart2');
    const myChart2 = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
                label: '# of Votes',
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            maintainAspectRatio: false
        }
    });
    const pie = $('#myPie');
    const myPie = new Chart(pie, {
        type: 'doughnut',
        data: {
          labels: [
            'Red',
            'Blue',
            'Yellow'
          ],
          datasets: [{
            label: 'My First Dataset',
            data: [300, 50, 100],
            hoverOffset: 4
          }]
        }
    });
    const pie2 = $('#myPie2');
    const myPie2 = new Chart(pie2, {
        type: 'doughnut',
        data: {
          labels: [
            'Red',
            'Blue',
            'Yellow'
          ],
          datasets: [{
            label: 'My First Dataset',
            data: [300, 50, 100],
            backgroundColor: [
              'rgb(255, 99, 132)',
              'rgb(54, 162, 235)',
              'rgb(255, 205, 86)'
            ],
            hoverOffset: 4
          }]
        }
    });
    
function enableResizers() {
    $('.resizers').unbind("mouseenter mouseleave");
    $('.resizers').hover(function() {
        $(this).toggleClass('inactive');
        $(this).find('.resizer').toggleClass('hidden');
        //$(this).find('.x').toggleClass('hidden');
    });
}

enableResizers();
    
    
Chart.defaults.global.defaultFontColor = "#fff";

makeResizableDiv('#item1');
makeResizableDiv('#item2');
makeResizableDiv('#item3');
makeResizableDiv('#item4');
    
itemList = [];

function resetEditWidgetTable() {
    var table = $('#edit_widget_table')
    if ($.fn.DataTable.isDataTable('#edit_widget_table')) {
        var table = $('#edit_widget_table').DataTable();
        table.destroy();
    }
        
    let data = ['\<i id=\"add_new_point_button\" class=\"action_button fa-solid fa-circle-plus\"\>\<\/i\>',
                 '\<input type=\"text\" value=\"\"\>',
                 '\<input type=\"text\" value=\"\"\>',
                 '\<input type=\"text\" value=\"\"\>',
                 '\<input type=\"color\" value=\"\#FFFFFF\"\>',
                 '\<input type=\"text\" value=\"\"\>'];
  let columns = [{
        title: ""
      }, {
        title: "Point Name"
      }, {
        title: "Display Name"
      }, {
        title: "Units"
      }, {
        title: "Color"
      }, {
        title: "Values"
      }];
    
    $('#edit_widget_table').dataTable({
        "data": data,
        "columns": columns
    });
}

                         
$('.blur_backdrop').click(function() {
    resetLayout();
})
    
function resetLayout() {
    $('#add_new_widget_container').addClass('hidden');
    $('#edit_widget_container').addClass('hidden');
    $('.resizers').addClass('inactive');
    $('.item').removeClass('select-edit-active');
    $('.item').prop("onclick", null).off("click");
}
    
$('#enable_select-edit').click(function() {
    $('.resizers').toggleClass('inactive');
    $('.item').toggleClass('select-edit-active');
    
    $('.item').click(function() {
        // reset widget table
        resetEditWidgetTable();
        // setup form based on item clicked
        for (let i=0; i<itemList.length; i++) {
            if (itemList[i].item_id == this.id) {
              var dataObject = itemList[i].getConfig();
              $('#edit_widget_table').dataTable().row.add(dataObject.data).draw(false);
            }
        }
        $('#edit_widget_container').toggleClass('hidden');
    })
    
})

function saveOrder() {
    for (let i=0; i<itemList.length; i++) {
        itemList[i].saveOrder();
    }
}
    
$('#add_new_widget_submit').click(function() {
    var chartType = $('input[name=select_widget]:checked').val();
    console.log("Creating new chart of type " + chartType);
    $('#add_new_widget_container').toggleClass('hidden');
})
    
$('.close_button').click(function() {
    resetLayout();
})
    
$('#add_pie_chart_button').click(function() {
    itemList.push(new PieChart("id" + (new Date()).getTime()));
})
    
$('.x').click(function() {
    $(this).closest('div[class=item]').remove();
})
    
</script>
      
</body>
</html>
